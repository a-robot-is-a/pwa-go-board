<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/pwa-go-board/manifest.webmanifest">
	<style>
  		body {
    		margin: 0;
    		padding: 0;
    		background: #fff8dc;
    		display: flex;
    		justify-content: center;
    		align-items: center;
    		height: 100vh;
  		}

  		#svg-board svg {
    		width: 95vw;
    		height: auto;
    		max-width: 400px;
    		box-shadow: 0 0 10px rgba(0,0,0,0.2);
    		background: #f5deb3;
    		border-radius: 8px;
  		}

  		p {
    		font-family: sans-serif;
    		color: #444;
    		text-align: center;
  		}
	</style>
</head>
<body>
	<div id="svg-board"></div>

	<script>
  let lastSeen = 0; // Zuletzt bekannter Zeitstempel

  function ladeSVG() {
    fetch("config.json")
      .then(response => response.json())
      .then(config => {
        return fetch(config.server_url + "?v=" + Date.now());
      })
      .then(response => {
        if (!response.ok) throw new Error("Server not reachable");
        return response.text();
      })
      .then(svg => {
        document.getElementById("svg-board").innerHTML = svg;
      })
      .catch(err => {
        document.getElementById("svg-board").innerHTML = `
          <div style="
            max-width: 400px;
            margin: 1em auto;
            padding: 1em;
            background-color: #fff0e6;
            color: #994d00;
            border-radius: 10px;
            font-family: sans-serif;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;">
            <h3 style="margin-top: 0;">Game board not available</h3>
            <p>The board could not be loaded at the moment.</p>
            <p>The server address may have been changed or the server is offline.</p>
            <p>The app tries again automatically.</p>
          </div>
        `;
      });
  }

  function prüfeUpdate() {
    fetch("config.json")
      .then(r => r.json())
      .then(config => {
        return fetch(config.server_url + "?timestamp");
      })
      .then(r => r.text())
      .then(ts => {
        const stamp = parseInt(ts);
        if (stamp > lastSeen) {
          lastSeen = stamp;
          ladeSVG(); // Nur neu laden bei Änderung
        }
      })
      .catch(err => {
        // Optional: Log oder Anzeige bei Verbindungsfehler
      });
  }

  // Initialer Ladevorgang
  ladeSVG();

  // Regelmäßig nur den Zeitstempel prüfen
  setInterval(prüfeUpdate, 5000); // alle 5 Sek.
</script>

</body>
</html>
